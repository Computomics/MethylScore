/* -------------------------------------------------
 * Nextflow config file for MENDEL
 * -------------------------------------------------
 */

env.PICARD_PATH = "/net/gmi.oeaw.ac.at/software/mendel/intel-x86_64-sandybridge-avx/software/picard/2.6.0-Java-1.8.0_131"
process {
  executor = 'pbs'

  withName: MethylScore_deduplicate {
	module = ['picard/2.6.0-Java-1.8.0_131', 'BamTools/2.4.0-foss-2016a', 'SAMtools/1.3.1-foss-2016a', 'BEDTools/2.27.1-foss-2016b']
  	cpus = { 1 * task.attempt }
  	memory = { 8.GB * task.attempt }
  	time = { 8.h * task.attempt }
  }

  withName: MethylScore_callConsensus {
	module = ['SAMtools/1.3.1-foss-2016a', 'Perl/5.22.1-foss-2016a', 'MethylExtract/1.9.1']
  	cpus = { 1 * task.attempt }
  	memory = { 8.GB * task.attempt }
  	time = { 8.h * task.attempt }
  }

  withName: MethylScore_chromosomalmatrix {
  	cpus = { 1 * task.attempt }
  	memory = { 1.GB * task.attempt }
  	time = { 1.h * task.attempt }
  }

  withName: MethylScore_genomematrix {
  	cpus = { 1 * task.attempt }
  	memory = { 1.GB * task.attempt }
  	time = { 1.h * task.attempt }
  }

  withName: MethylScore_callMRs {
  	cpus = { 1 * task.attempt }
  	memory = { 8.GB * task.attempt }
  	time = { 4.h * task.attempt }
  }

  withName: MethylScore_igv {
  	cpus = { 1 * task.attempt }
  	memory = { 1.GB * task.attempt }
  	time = { 1.h * task.attempt }
  }

  withName: MethylScore_splitMRs {
  	cpus = { 1 * task.attempt }
  	memory = { 1.GB * task.attempt }
  	time = { 1.h * task.attempt }
  }

  withName: MethylScore_callDMRs {
	module = ['Python/2.7.11-foss-2016a','tabix']
  	cpus = { 1 * task.attempt }
  	memory = { 1.GB * task.attempt }
  	time = { 2.h * task.attempt }
  }

  withName: MethylScore_mergeDMRs {
	module = ['Python/2.7.11-foss-2016a']
  	cpus = { 1 * task.attempt }
  	memory = { 1.GB * task.attempt }
  	time = { 1.h * task.attempt }
  }
  errorStrategy = { ( task.exitStatus == 143 || task.exitStatus == 137 ) ? 'retry' : 'finish' }
  maxRetries = 3
  maxErrors = '-1'
}

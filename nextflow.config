/*
 * -------------------------------------------------
 *  Nextflow config file for MethylScore pipeline
 * -------------------------------------------------
 * Default config options for all environments.
 * Cluster-specific config options should be saved
 * in the conf folder and imported under a profile
 * name here.
 */

process.container = 'beckerlab/methylscore:latest'

manifest {
    homePage = 'https://github.com/Gregor-Mendel-Institute/MethylScore-nf'
    description = "A nextflow implementation of Computomics' MethylScore pipeline"
    name = 'MethylScore'
    version = '0.1.14-nf'
    mainScript = 'main.nf'
    nextflowVersion = '>=19.01.0'
}

includeConfig 'conf/base.config'

profiles {
  local { process.executor = 'local' }
  mendel { includeConfig 'conf/mendel.config' }
  cbe { includeConfig 'conf/cbe.config' }
  singularity { singularity.enabled = true }
  docker { docker.enabled = true }
  conda { process.conda = "$baseDir/environment.yaml" }
  testing { includeConfig 'conf/testing.config' }
}

// Default parameters
params {
  GENOME = false
  SAMPLE_SHEET = false
  BEDGRAPH = false
  PROJECT_FOLDER = "./results"

  HUMAN = false
  ROI = false

  STATISTICS = true
  IGV = false
  DO_DEDUP = true

  // DMR parameters
  MR_FREQ_CHANGE = 20
  MR_FREQ_DISTANCE = 30
  CLUSTER_MIN_METH = 20
  CLUSTER_MIN_METH_DIFF = 20
  SLIDING_WINDOW_SIZE = 0
  SLIDING_WINDOW_STEP = 0
  DMR_MIN_C = 10
  DMR_MIN_COV = 3
  MR_BATCH_SIZE = 500
  HDMR_FOLD_CHANGE = 3
  FDR_CUTOFF = 0.05

  // Consensus parameters
  MIN_QUAL = 30
  AUTOTRIM = false
  IGNORE_OT = "0,0,0,0"
  IGNORE_OB = "0,0,0,0"

  // MR parameters
  MIN_COVERAGE = 1
  MR_MIN_C = 20
  DESERT_SIZE = 100
  TRIM_METHRATE = 10
  MERGE_DIST = 30
  MR_PARAMS = false
}

workflow.onComplete = {
    if ( workflow.success ) {
      println "[$workflow.complete] >> MethylScore finished SUCCESSFULLY after $workflow.duration and found ${DMRs.getVal().countLines()} DMRs"
    } else {
      println "[$workflow.complete] >> MethylScore finished with ERRORS after $workflow.duration"
    }
}
